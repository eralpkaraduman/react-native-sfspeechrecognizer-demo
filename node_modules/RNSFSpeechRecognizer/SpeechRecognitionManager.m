//
//  SpeechRecognitionManager.m
//  RNSFSpeechRecognizer
//
//  Created by Eralp Karaduman on 6/18/17.
//  Copyright Â© 2017 Super Damage. All rights reserved.
//

#import "SpeechRecognitionManager.h"
@import AVFoundation;
@import Speech;

@implementation SpeechRecognitionManager

#pragma mark - Microphone Permissions

- (BOOL)isMicrophonePermissionGranted {
    AVAudioSessionRecordPermission status = [[AVAudioSession sharedInstance] recordPermission];
    return status == AVAudioSessionRecordPermissionGranted;
}

- (BOOL)isMicrophonePermissionDenied {
    AVAudioSessionRecordPermission status = [[AVAudioSession sharedInstance] recordPermission];
    return status == AVAudioSessionRecordPermissionDenied;
}

- (void)requestMicrophonePermission:(void (^ _Nonnull)(BOOL))callback {
    [[AVAudioSession sharedInstance] requestRecordPermission:^(BOOL granted) {
        [[NSOperationQueue mainQueue] addOperationWithBlock:^{
            callback(granted);
        }];
    }];
}

#pragma mark - Speech Recognition Permissions

- (BOOL)isSpeechRecognitionPermissionGranted {
    SFSpeechRecognizerAuthorizationStatus status = [SFSpeechRecognizer authorizationStatus];
    return status == SFSpeechRecognizerAuthorizationStatusAuthorized;
}

- (BOOL)isSpeechRecognitionPermissionDenied {
    SFSpeechRecognizerAuthorizationStatus status = [SFSpeechRecognizer authorizationStatus];
    return status == SFSpeechRecognizerAuthorizationStatusDenied;
}

- (void)requestSpeechRecognitionPermission:(void (^ _Nonnull)(BOOL))callback {
    [SFSpeechRecognizer requestAuthorization:^(SFSpeechRecognizerAuthorizationStatus status) {
        [[NSOperationQueue mainQueue] addOperationWithBlock:^{
            callback([self isMicrophonePermissionGranted]);
        }];
    }];
}

@end
